anti-virus
åŸºæœ¬ä¸Šå°±æ˜¯æ”¹ç‰¹å¾ç 
æ€è½¯ ä½¿ç”¨ç‰¹å¾ç é™æ€æŸ¥æ€ æ¯”å¦‚å“ˆå¸Œå€¼ å±€éƒ¨å“ˆå¸Œ æ£€æŸ¥æˆ‘å‘¢è§ç­¾åä¿¡æ¯ æ–‡ä»¶ä¿¡æ¯
å¦‚æœç—…æ¯’åº“é‡Œé¢æ²¡æœ‰è¿™ä¸ªç‰¹å¾ç  å°±å¯èƒ½èº²è¿‡å»

è¿˜æœ‰çš„æ˜¯ä¸Šä¼ äº‘ç«¯è¿›è¡Œäº‘æŸ¥æ€
æºç å…æ€
åˆ†ç¦»å…æ€  -  ç”¨ä¸€ä¸ªåŠ è½½å™¨å°†äº‘ç«¯çš„ç—…æ¯’è¯»å–åˆ°å†…å­˜ä¸­
ä¿®æ”¹ç‰¹å¾ç å…æ€
åŠ å£³å…æ€
èŠ±æŒ‡ä»¤å…æ€
å†…å­˜å…æ€
ç™½åŠ é»‘

ç”¨strings å¯ä»¥å°†äºŒè¿›åˆ¶æ–‡ä»¶ä¸­çš„æ–‡æœ¬æå–å‡ºæ¥
æ‰“å¼€ä¹‹åçœ‹è§çš„é‚£äº›éƒ½æ˜¯ç‰¹å¾ç 
strings xxx.exe | shellcode ç›´æ¥æ£€ç´¢shellcode éå¸¸æ˜æ˜¾
ä½¿ç”¨VirTeståˆ¶ä½œæµ‹è¯•æ–‡ä»¶

è¿›è™šæ‹Ÿæœºæ‰“å¼€æµ‹è¯•æ–‡ä»¶ æ‰“å¼€.viræ–‡ä»¶

ç‚¹å‡»å®šä½ç‰¹å¾ç  ä¼šåŸºäºæ€è½¯æ ‡è®°å‡ºæ¥å“ªäº›ç‰¹å¾ç è¢«æŸ¥æ€äº†
è‡ªåŠ¨å°±è¡Œ

åšå…æ€äº†ä¹‹åå°±æŸ¥ä¸å‡ºæ¥äº†
ç‚¹å‡»å·¦ä¾§åç§»é‡å°±èƒ½æ‰¾åˆ°å¯¹åº”ä½ç½®
å°±æ˜¯å°†æ£€æµ‹åˆ°çš„ç‰¹å¾ç éƒ½æ”¹ä¸€ä¸‹
ç”¨x64dbgå¯ä»¥æŸ¥çœ‹æœºå™¨ç  å°±æ˜¯åœ¨ä¸€äº›å®¹æ˜“è¢«æŸ¥æ€çš„åœ°æ–¹æ’å…¥ä¸€äº›ç©ºæŒ‡ä»¤(nop)å’Œæ— æ•ˆæŒ‡ä»¤åƒåœ¾æŒ‡ä»¤(äº¤æ¢å¯„å­˜å™¨è‡ªå·±å’Œè‡ªå·±çš„å€¼æˆ–è€…å°†eaxå’Œ0å¼‚æˆ–)å°±å«èŠ±æŒ‡ä»¤æ–¹å¼ æˆ–è€…æ‹†åˆ†æŒ‡ä»¤ æˆ–è€…å°†åŒåŠŸèƒ½æŒ‡ä»¤æ›¿æ¢

æ¶æ„ä»£ç è¿è¡Œçš„æ—¶å€™ä¼šç”³è¯·å†…å­˜ç©ºé—´ æœ‰çš„æ€è½¯ä¼šæ£€æµ‹å†…å­˜

æœ‰çš„æ–‡ä»¶é»˜è®¤åœ¨ç³»ç»Ÿçš„ç™½åå•é‡Œé¢ æˆ‘ä»¬ç›´æ¥å¹²è¿™äº›dll è¿™å°±å«dllåŠ«æŒ 
ç™½åå•ç¨‹åºåŠ è½½æˆ‘ä»¬è‡ªå·±çš„æ¶æ„ç¨‹åºå°±æ˜¯ç™½åŠ é»‘


å’±ä»¬ä½¿ç”¨çš„æ˜¯åˆ†ç¦»å…æ€
åŠ è½½å™¨+æœåŠ¡å™¨
åŠ è½½å™¨ç”³è¯·ä¸€æ®µå†…å­˜ç©ºé—´ä¹‹ååŠ è½½æ¶æ„ä»£ç ç„¶åè¿è¡Œ
åŠ è½½å™¨ä¸é™è¯­è¨€
æˆ‘ä»¬ç”¨shellcode shellcodeè¿˜å¯ä»¥åŠ å¯† å„ç§åŠ å¯† shellcodeåŠ å¯†åé€šè¿‡åŠ è½½å™¨è§£å¯†åæ‰“å…¥å†…å­˜æ‰§è¡Œ
å¦‚æœè¿™ç§æœ¨é©¬å¤±æ•ˆäº† å¾ˆå®¹æ˜“å†æ¬¡ç”Ÿæˆ 

å…ˆè¦å®‰è£…gcc goè¯­è¨€ä¸­çš„raceæœ‰éå¸¸å¥½çš„å…æ€æ•ˆæœ
-raceå‚æ•°ç”¨äºæ£€æµ‹å¹¶å‘ç°ä»£ç ä¸­çš„æ•°æ®ç«äº‰é—®é¢˜ å¤šä¸ªä»»åŠ¡åŒæ—¶è®¿é—®å…±äº«å˜é‡çš„æ—¶å€™å¯èƒ½ä¼šå¯¼è‡´æ•°æ®ç«äº‰å‘ç”Ÿé”™è¯¯ raceå‚æ•°ä¼šå¯ç”¨æ•°æ®ç«äº‰æ£€æµ‹å™¨è¿™æ˜¯ä¸€ä¸ªå¤æ‚çš„å·¥å…· éœ€è¦å†…å­˜è®¿é—®æ§åˆ¶è¿›è¡Œç»†é¢—ç²’åº¦çš„ç›‘æ§ è¿™ç§ç›‘æ§æ”¹å˜äº†æ¶æ„ä»£ç çš„åŸæœ‰ç»“æ„ å¯¼è‡´æ€è½¯ä¸èƒ½æ­£ç¡®è¯†åˆ«æ¶æ„ä»£ç 
goè¯­è¨€ä¸­çš„æ•°æ®ç«äº‰æ£€æµ‹å™¨æ˜¯ä½¿ç”¨c++ç¼–å†™çš„ cgoæ”¯æŒgoè¯­è¨€ä¸­å¼•ç”¨æˆ–ç›´æ¥ç¼–å†™c/c++ä»£ç  æ‰€ä»¥ä½¿ç”¨raceç¼–è¯‘ç¨‹åºçš„æ—¶å€™éœ€è¦å®‰è£…gccç¼–è¯‘å™¨å’Œå¯ç”¨cgoåŠŸèƒ½

è¿™ä¸ªå¯ä»¥åœ¨ç‰©ç†æœºå¼„äº†

ç„¶åç”¨CobaltStrikeæä¸€ä¸‹
â”Œâ”€â”€(rootğŸ’€tyza66)-[~/CVE-2018-8174_EXP-master]
â””â”€# cd                           
                                                                             
â”Œâ”€â”€(rootğŸ’€tyza66)-[~]
â””â”€# unzip CobaltStrike4.3.zip         
Archive:  CobaltStrike4.3.zip
   creating: CobaltStrike4.3/
  inflating: CobaltStrike4.3/peclone  
  inflating: CobaltStrike4.3/cobaltstrike  
  inflating: CobaltStrike4.3/readme.txt  
  inflating: CobaltStrike4.3/agscript  
  inflating: CobaltStrike4.3/teamserver  
  inflating: CobaltStrike4.3/.cobaltstrike.beacon_keys  
  inflating: CobaltStrike4.3/start.sh  
  inflating: CobaltStrike4.3/c2lint  
  inflating: CobaltStrike4.3/license.pdf  
 extracting: CobaltStrike4.3/cobaltstrike.auth  
   creating: CobaltStrike4.3/third-party/
  inflating: CobaltStrike4.3/third-party/README.winvnc.txt  
  inflating: CobaltStrike4.3/third-party/winvnc.x86.dll  
  inflating: CobaltStrike4.3/third-party/winvnc.x64.dll  
  inflating: CobaltStrike4.3/cobaltstrike.store  
  inflating: CobaltStrike4.3/icon.jpg  
  inflating: CobaltStrike4.3/hook.jar  
  inflating: CobaltStrike4.3/update.jar  
  inflating: CobaltStrike4.3/update  
  inflating: CobaltStrike4.3/cobaltstrike.jar  
  inflating: CobaltStrike4.3/start.bat  
                                                                             
â”Œâ”€â”€(rootğŸ’€tyza66)-[~]
â””â”€# cd CobaltStrike4.3         
                                                                             
â”Œâ”€â”€(rootğŸ’€tyza66)-[~/CobaltStrike4.3]
â””â”€# ls
agscript           cobaltstrike.jar    license.pdf  start.sh     update.jar
c2lint             cobaltstrike.store  peclone      teamserver
cobaltstrike       hook.jar            readme.txt   third-party
cobaltstrike.auth  icon.jpg            start.bat    update

ä¹‹åç»™ä¸€ä¸‹æƒé™
â”Œâ”€â”€(rootğŸ’€tyza66)-[~/CobaltStrike4.3]
â””â”€# chmod +x teamserver start.sh 

â”Œâ”€â”€(rootğŸ’€tyza66)-[~/CobaltStrike4.3]
â””â”€# ./teamserver 192.168.101.53 123456
[*] Will use existing X509 certificate and keystore (for SSL)
Picked up _JAVA_OPTIONS: -Dawt.useSystemAAFontSettings=on -Dswing.aatext=true
Hook start
Found desired class: common/Authorization
[+] Team server is up on 0.0.0.0:41337
[*] SHA256 hash of SSL cert is: e4aca4bc16d4673641ae6d44101e2eab09a37b6c6b79fd5022ad1d93a27615f0
 
ç›´æ¥å¯åŠ¨teamç«¯ æ³¨æ„è¿™ä¸ªå·¥å…·å½“å‰ç‰ˆæœ¬æœ‰bug åƒä¸‡ä¸è¦æš´éœ²åœ¨å¤–ç½‘

å®¢æˆ·ç«¯è”æœºçš„æ—¶å€™ä¹Ÿè¦æ³¨æ„SHA256 hash of SSL cert is: e4aca4bc16d4673641ae6d44101e2eab09a37b6c6b79fd5022ad1d93a27615f0
å“ˆå¸Œå€¼åº”è¯¥æ˜¯ä¸€è‡´çš„
ä¹‹åä¸è¦å…³ å†å•ç‹¬çš„å¯åŠ¨ä¸€ä¸ªå®¢æˆ·ç«¯

./start.sh
sudo apt-get update
sudo apt-get install libxaw7 libxtst6 libxi6

æ¢java17 è¡Œäº†
./start.sh

å¯åŠ¨ä¹‹åè¾“å…¥ipç«¯å£è¿˜æœ‰å¯†ç  ç”¨æˆ·åéšä¾¿å¡«
å…ˆæ–°å»ºä¸€ä¸ªç›‘å¬
ä¹‹ååˆ›å»ºä¸€ä¸ªbinæ ¼å¼çš„åé—¨
æ·»åŠ HTTP Hosts ä¸‹é¢çš„ä¹Ÿå¡«å†™æœ¬åœ°kali é€‰ä¸€ä¸‹ç«¯å£
ä¹‹åç”Ÿæˆä¸€ä¸ªpayload ç‚¹å‡»æ”»å‡»  ç‚¹æœ€åä¸€ä¸ªwindow(s)
é€‰åˆšæ‰çš„ç›‘å¬å™¨ ç±»å‹é€‰raw x64æŒ‘ä¸Š
ä¹‹åç”¨goè¯­è¨€è§£binæ–‡ä»¶æ··æ·†åæ”¾å…¥å†…å­˜ä¸­è¿è¡Œå³å¯
è¿˜å¯ä»¥ç”¨Veil
use 1
é€‰æ‹© Evasioné€ƒé€¸
list use17(13)
é€‰æ‹©goè¯­è¨€æ¨¡å—
é€‰3 è‡ªå®šä¹‰payload


